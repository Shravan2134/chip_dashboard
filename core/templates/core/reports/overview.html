{% extends "core/base.html" %}

{% block title %}Reports · Transaction Hub{% endblock %}
{% block page_title %}Reports & Analytics{% endblock %}
{% block page_subtitle %}Comprehensive insights into your business performance{% endblock %}

{% block content %}
<style>
    .reports-wrapper {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    /* Basic Stat Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    
    .stat-box {
        background: #ffffff;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .stat-box.profit {
        border-left: 4px solid #28a745;
    }
    
    .stat-box.loss {
        border-left: 4px solid #dc3545;
    }
    
    .stat-box.turnover {
        border-left: 4px solid #007bff;
    }
    
    .stat-label {
        font-size: 12px;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
        margin-bottom: 8px;
    }
    
    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #333;
        margin-bottom: 4px;
    }
    
    .stat-note {
        font-size: 12px;
        color: #999;
    }
    
    /* Basic Tabs */
    .tabs-simple {
        display: flex;
        gap: 0;
        border-bottom: 2px solid #ddd;
        margin-bottom: 20px;
    }
    
    .tab-simple {
        padding: 10px 20px;
        text-decoration: none;
        color: #666;
        font-size: 14px;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
    }
    
    .tab-simple:hover {
        color: #333;
        background: #f5f5f5;
    }
    
    .tab-simple.active {
        color: #007bff;
        border-bottom-color: #007bff;
    }
    
    /* Chart Sections */
    .chart-section {
        background: #ffffff;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .chart-header {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #ddd;
    }
    
    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    
    /* Client Filter */
    .filter-section {
        margin-bottom: 20px;
        padding: 16px;
        background: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }
    
    .filter-section label {
        font-size: 14px;
        font-weight: 500;
        color: #333;
    }
    
    .filter-section select {
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        background: #ffffff;
        min-width: 250px;
        cursor: pointer;
    }
    
    .filter-section select:focus {
        outline: none;
        border-color: #007bff;
    }
    
    .btn-compact {
        padding: 8px 16px;
        font-size: 13px;
        border-radius: 4px;
        border: 1px solid #ccc;
        background: #ffffff;
        color: #333;
        cursor: pointer;
        font-weight: 500;
        text-decoration: none;
    }
    
    .btn-compact:hover {
        background: #f5f5f5;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .charts-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<div class="reports-wrapper">
    <!-- Client Filter and Month Selection -->
    <div class="filter-section">
        <label>Filter by Client:</label>
        <select id="clientFilter" onchange="changeClient(this.value)">
        <option value="">All Clients</option>
        {% for client in all_clients %}
        <option value="{{ client.id }}" {% if selected_client_id == client.id %}selected{% endif %}>{{ client.name }}{% if client.code %} ({{ client.code }}){% endif %}</option>
        {% endfor %}
    </select>
    {% if selected_client_id %}
        <a href="?report_type={{ report_type }}{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}{% if selected_month %}&month={{ selected_month }}{% endif %}" class="btn-compact">Clear Filter</a>
    {% endif %}
    {% if not all_clients %}
        <span style="font-size: 13px; color: #64748b; font-style: italic;">No clients available</span>
    {% endif %}
    
    <label style="margin-left: 20px;">Select Month:</label>
    <input type="month" id="monthSelector" name="month" value="{{ selected_month|default:'' }}" max="{{ today|date:'Y-m' }}" onchange="changeMonth(this.value)" style="padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; background: #ffffff; min-width: 150px; cursor: pointer;">
</div>

<!-- Report Type Tabs -->
<div class="tabs-simple">
    <a href="?report_type=daily{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}{% if selected_month %}&month={{ selected_month }}{% endif %}" onclick="return changeReportType('daily', event)" class="tab-simple {% if report_type == 'daily' %}active{% endif %}">
        Daily
    </a>
    <a href="?report_type=weekly{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}{% if selected_month %}&month={{ selected_month }}{% endif %}" onclick="return changeReportType('weekly', event)" class="tab-simple {% if report_type == 'weekly' %}active{% endif %}">
        Weekly
    </a>
    <a href="?report_type=monthly{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}{% if selected_month %}&month={{ selected_month }}{% endif %}" onclick="return changeReportType('monthly', event)" class="tab-simple {% if report_type == 'monthly' %}active{% endif %}">
        Monthly
    </a>
</div>

<!-- Summary Stats -->
<div class="stats-grid">
        <div class="stat-box turnover">
        <div class="stat-label">Total Turnover</div>
        <div class="stat-value">₹ {{ total_turnover|default:0|floatformat:1 }}</div>
        <div class="stat-note">All-time transaction volume</div>
    </div>
        <div class="stat-box profit">
        <div class="stat-label">Your Total Profit</div>
        <div class="stat-value {% if your_total_profit >= 0 %}positive{% else %}negative{% endif %}">₹ {{ your_total_profit|default:0|floatformat:1 }}</div>
        <div class="stat-note">
            Cash-flow based: Money received from clients (₹{{ your_total_income_from_clients|default:0|floatformat:1 }}) 
            - Money paid to clients (₹{{ your_total_paid_to_clients|default:0|floatformat:1 }})
        </div>
    </div>
    <div class="stat-box profit">
        <div class="stat-label">My Profit</div>
        <div class="stat-value {% if my_profit >= 0 %}positive{% else %}negative{% endif %}">₹ {{ my_profit|default:0|floatformat:1 }}</div>
        <div class="stat-note">Your share from settlements (split from ClientExchangeReportConfig)</div>
    </div>
    <div class="stat-box profit">
        <div class="stat-label">Friend Profit</div>
        <div class="stat-value {% if friend_profit >= 0 %}positive{% else %}negative{% endif %}">₹ {{ friend_profit|default:0|floatformat:1 }}</div>
        <div class="stat-note">Friend share from settlements (split from ClientExchangeReportConfig)</div>
    </div>
</div>

{% if report_type == 'daily' %}
<!-- Daily Report Section -->
    <div class="chart-section">
    <div class="chart-header">Daily Trends (Last 30 Days)</div>
    <canvas id="dailyTrendsChart" style="max-height: 400px;"></canvas>
</div>

<div class="charts-grid">
    <div class="chart-section">
        <div class="chart-header">Transaction Type Breakdown</div>
        <canvas id="typeBreakdownChart" style="max-height: 320px;"></canvas>
    </div>
    
    {% if client_labels %}
    <div class="chart-section">
        <div class="chart-header">Top Clients by Profit (Last 30 Days)</div>
        <canvas id="topClientsChart" style="max-height: 320px;"></canvas>
    </div>
    {% endif %}
</div>

{% elif report_type == 'weekly' %}
<!-- Weekly Report Section -->
    <div class="chart-section">
    <div class="chart-header">Weekly Trends (Last 4 Weeks)</div>
    <canvas id="weeklyTrendsChart" style="max-height: 400px;"></canvas>
</div>

<div class="charts-grid">
    <div class="chart-section">
        <div class="chart-header">Transaction Type Breakdown</div>
        <canvas id="typeBreakdownChart" style="max-height: 320px;"></canvas>
    </div>
    
    <div class="chart-section">
        <div class="chart-header">Daily Trends (Last 30 Days)</div>
        <canvas id="dailyTrendsChart" style="max-height: 320px;"></canvas>
    </div>
</div>

{% elif report_type == 'monthly' %}
<!-- Monthly Report Section -->
    <div class="chart-section">
    <div class="chart-header">Monthly Trends (Last 6 Months)</div>
    <canvas id="monthlyTrendsChart" style="max-height: 400px;"></canvas>
</div>

<div class="charts-grid">
    <div class="chart-section">
        <div class="chart-header">Transaction Type Breakdown</div>
        <canvas id="typeBreakdownChart" style="max-height: 320px;"></canvas>
    </div>
    
    <div class="chart-section">
        <div class="chart-header">Weekly Trends (Last 4 Weeks)</div>
        <canvas id="weeklyTrendsChart" style="max-height: 320px;"></canvas>
    </div>
</div>
{% endif %}
</div>

<script>
// Disable automatic scroll restoration
if ('scrollRestoration' in history) {
    history.scrollRestoration = 'manual';
}

// Preserve scroll position when changing report type
function changeReportType(type, event) {
    event.preventDefault();
    const currentScrollY = window.scrollY || window.pageYOffset;
    const url = new URL(window.location);
    
    const startDate = url.searchParams.get('start_date');
    const endDate = url.searchParams.get('end_date');
    const dateParam = url.searchParams.get('date');
    const clientType = url.searchParams.get('client_type');
    const clientId = url.searchParams.get('client');
    const month = url.searchParams.get('month');
    
    url.searchParams.set('report_type', type);
    if (startDate) url.searchParams.set('start_date', startDate);
    if (endDate) url.searchParams.set('end_date', endDate);
    if (dateParam) url.searchParams.set('date', dateParam);
    if (clientType) url.searchParams.set('client_type', clientType);
    if (clientId) url.searchParams.set('client', clientId);
    if (month) url.searchParams.set('month', month);
    
    sessionStorage.setItem('reportScrollPosition', currentScrollY);
    window.location.href = url.toString();
    return false;
}

function changeClient(clientId) {
    const currentScrollY = window.scrollY || window.pageYOffset;
    const url = new URL(window.location);
    
    const startDate = url.searchParams.get('start_date');
    const endDate = url.searchParams.get('end_date');
    const dateParam = url.searchParams.get('date');
    const reportType = url.searchParams.get('report_type') || 'monthly';
    const clientType = url.searchParams.get('client_type');
    const month = url.searchParams.get('month');
    
    url.searchParams.set('report_type', reportType);
    if (startDate) url.searchParams.set('start_date', startDate);
    if (endDate) url.searchParams.set('end_date', endDate);
    if (dateParam) url.searchParams.set('date', dateParam);
    if (clientType) url.searchParams.set('client_type', clientType);
    if (month) url.searchParams.set('month', month);
    if (clientId) {
        url.searchParams.set('client', clientId);
    } else {
        url.searchParams.delete('client');
    }
    
    sessionStorage.setItem('reportScrollPosition', currentScrollY);
    window.location.href = url.toString();
}

function changeMonth(monthValue) {
    const currentScrollY = window.scrollY || window.pageYOffset;
    const url = new URL(window.location);
    
    const startDate = url.searchParams.get('start_date');
    const endDate = url.searchParams.get('end_date');
    const dateParam = url.searchParams.get('date');
    const reportType = url.searchParams.get('report_type') || 'monthly';
    const clientType = url.searchParams.get('client_type');
    const clientId = url.searchParams.get('client');
    
    url.searchParams.set('report_type', reportType);
    // Remove time travel params when selecting month
    url.searchParams.delete('start_date');
    url.searchParams.delete('end_date');
    url.searchParams.delete('date');
    if (clientType) url.searchParams.set('client_type', clientType);
    if (clientId) url.searchParams.set('client', clientId);
    if (monthValue) {
        url.searchParams.set('month', monthValue);
    } else {
        url.searchParams.delete('month');
    }
    
    sessionStorage.setItem('reportScrollPosition', currentScrollY);
    window.location.href = url.toString();
}

// Restore scroll position
(function() {
    const savedScroll = sessionStorage.getItem('reportScrollPosition');
    if (savedScroll !== null) {
        const scrollPos = parseInt(savedScroll);
        window.scrollTo(0, scrollPos);
        sessionStorage.removeItem('reportScrollPosition');
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                window.scrollTo(0, scrollPos);
            });
        }
        setTimeout(function() {
            window.scrollTo(0, scrollPos);
        }, 100);
    }
})();

// Initialize all charts
function initializeCharts() {
    if (typeof Chart === 'undefined') {
        setTimeout(initializeCharts, 100);
        return;
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeCharts);
        return;
    }

    // Basic color palette
    const colors = {
        profit: '#28a745',
        loss: '#dc3545',
        turnover: '#007bff',
        funding: '#17a2b8',
        settlement: '#6c757d',
        background: {
            profit: 'rgba(40, 167, 69, 0.1)',
            loss: 'rgba(220, 53, 69, 0.1)',
            turnover: 'rgba(0, 123, 255, 0.1)',
        }
    };

// Daily Trends Chart
{% if report_type == 'daily' or report_type == 'weekly' %}
const dailyChartEl = document.getElementById('dailyTrendsChart');
if (dailyChartEl) {
    const dailyCtx = dailyChartEl.getContext('2d');
    new Chart(dailyCtx, {
    type: 'line',
            data: {
                labels: {{ daily_labels|safe }},
                datasets: [
                    {
                        label: 'Profit',
                        data: {{ daily_profit|safe }},
                        borderColor: colors.profit,
                        backgroundColor: colors.background.profit,
                tension: 0.4,
                fill: true,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointHoverRadius: 6
            },
                    {
                        label: 'Loss',
                        data: {{ daily_loss|safe }},
                        borderColor: colors.loss,
                        backgroundColor: colors.background.loss,
                tension: 0.4,
                fill: true,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointHoverRadius: 6
            },
                    {
                        label: 'Turnover',
                        data: {{ daily_turnover|safe }},
                        borderColor: colors.turnover,
                        backgroundColor: colors.background.turnover,
                tension: 0.4,
                fill: true,
                borderWidth: 2,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                yAxisID: 'y1'
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    padding: 15,
                            font: { size: 13, weight: '600' },
                            usePointStyle: true
                }
            },
            tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                padding: 12,
                        titleFont: { size: 14, weight: '600' },
                        bodyFont: { size: 13 },
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 1, maximumFractionDigits: 1});
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                        grid: { color: 'rgba(0, 0, 0, 0.05)' },
                ticks: {
                            font: { size: 12 },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                beginAtZero: true,
                        grid: { drawOnChartArea: false },
                ticks: {
                            font: { size: 12 },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                            }
                    }
            },
            x: {
                        grid: { color: 'rgba(0, 0, 0, 0.05)' },
                        ticks: { font: { size: 12 } }
                    }
                }
            }
        });
    }
{% endif %}

// Weekly Trends Chart
{% if report_type == 'weekly' or report_type == 'monthly' %}
const weeklyChartEl = document.getElementById('weeklyTrendsChart');
if (weeklyChartEl) {
    const weeklyCtx = weeklyChartEl.getContext('2d');
    new Chart(weeklyCtx, {
    type: 'bar',
            data: {
                labels: {{ weekly_labels|safe }},
                datasets: [
                    {
                        label: 'Profit',
                        data: {{ weekly_profit|safe }},
                        backgroundColor: colors.profit + 'CC',
                        borderColor: colors.profit,
                        borderWidth: 2,
                        borderRadius: 6
            },
                    {
                        label: 'Loss',
                        data: {{ weekly_loss|safe }},
                        backgroundColor: colors.loss + 'CC',
                        borderColor: colors.loss,
                        borderWidth: 2,
                        borderRadius: 6
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    padding: 15,
                            font: { size: 13, weight: '600' },
                            usePointStyle: true
                }
            },
            tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                padding: 12,
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 1, maximumFractionDigits: 1});
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                        grid: { color: 'rgba(0, 0, 0, 0.05)' },
                ticks: {
                            font: { size: 12 },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                }
            },
            x: {
                        grid: { display: false },
                        ticks: { font: { size: 12 } }
                    }
                }
            }
        });
    }
{% endif %}

// Transaction Type Breakdown Chart
{% if report_type == 'daily' or report_type == 'weekly' or report_type == 'monthly' %}
const typeChartEl = document.getElementById('typeBreakdownChart');
if (typeChartEl) {
    const typeCtx = typeChartEl.getContext('2d');
        const typeColors = {{ type_colors|safe }};
        // Update colors to modern palette
        const modernColors = typeColors.map((c, i) => {
            const labels = {{ type_labels|safe }};
            if (labels[i] === 'Profit') return colors.profit;
            if (labels[i] === 'Loss') return colors.loss;
            if (labels[i] === 'Funding') return colors.funding;
            if (labels[i] === 'Settlement') return colors.settlement;
            return c;
        });
        
        new Chart(typeCtx, {
            type: 'doughnut',
            data: {
                labels: {{ type_labels|safe }},
                datasets: [{
                    data: {{ type_amounts|safe }},
                    backgroundColor: modernColors,
            borderWidth: 3,
            borderColor: '#ffffff'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 15,
                            font: { size: 13, weight: '600' },
                            usePointStyle: true
                }
            },
            tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                padding: 12,
                callbacks: {
                    label: function(context) {
                        const label = context.label || '';
                        const value = context.parsed || 0;
                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                        const percentage = ((value / total) * 100).toFixed(1);
                        return label + ': ₹' + value.toLocaleString('en-IN', {minimumFractionDigits: 1, maximumFractionDigits: 1}) + ' (' + percentage + '%)';
                    }
                }
            }
        }
    }
    });
}
{% endif %}

// Monthly Trends Chart
{% if report_type == 'monthly' %}
const monthlyChartEl = document.getElementById('monthlyTrendsChart');
if (monthlyChartEl) {
    const monthlyCtx = monthlyChartEl.getContext('2d');
    new Chart(monthlyCtx, {
    type: 'bar',
            data: {
                labels: {{ monthly_labels|safe }},
                datasets: [
                    {
                        label: 'Profit',
                        data: {{ monthly_profit|safe }},
                        backgroundColor: colors.profit + 'CC',
                        borderColor: colors.profit,
                        borderWidth: 2,
                        borderRadius: 6
            },
                    {
                        label: 'Loss',
                        data: {{ monthly_loss|safe }},
                        backgroundColor: colors.loss + 'CC',
                        borderColor: colors.loss,
                        borderWidth: 2,
                        borderRadius: 6
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    padding: 15,
                            font: { size: 13, weight: '600' },
                            usePointStyle: true
                }
            },
            tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                padding: 12,
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 1, maximumFractionDigits: 1});
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                        grid: { color: 'rgba(0, 0, 0, 0.05)' },
                ticks: {
                            font: { size: 12 },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                }
            },
            x: {
                        grid: { display: false },
                        ticks: { font: { size: 12 } }
                    }
                }
            }
        });
    }
{% endif %}

{% if report_type == 'daily' and client_labels %}
// Top Clients Chart
const clientsChartEl = document.getElementById('topClientsChart');
if (clientsChartEl) {
    const clientsCtx = clientsChartEl.getContext('2d');
    new Chart(clientsCtx, {
    type: 'bar',
            data: {
                labels: {{ client_labels|safe }},
                datasets: [{
                    label: 'Profit',
                    data: {{ client_profits|safe }},
                    backgroundColor: colors.profit + 'CC',
                    borderColor: colors.profit,
                    borderWidth: 2,
                    borderRadius: 6
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        indexAxis: 'y',
        plugins: {
                    legend: { display: false },
            tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                padding: 12,
                callbacks: {
                    label: function(context) {
                        return '₹' + context.parsed.x.toLocaleString('en-IN', {minimumFractionDigits: 1, maximumFractionDigits: 1});
                    }
                }
            }
        },
        scales: {
            x: {
                beginAtZero: true,
                        grid: { color: 'rgba(0, 0, 0, 0.05)' },
                ticks: {
                            font: { size: 12 },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                }
            },
            y: {
                        grid: { display: false },
                        ticks: { font: { size: 12 } }
            }
        }
    }
    });
}
{% endif %}
}

// Start chart initialization
initializeCharts();
</script>
{% endblock %}
