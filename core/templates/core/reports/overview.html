{% extends "core/base.html" %}

{% block title %}Reports · Broker Portal{% endblock %}
{% block page_title %}Reports & Analytics{% endblock %}
{% block page_subtitle %}Comprehensive insights into your business performance{% endblock %}

{% block content %}
<style>
    .reports-wrapper {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }
    
    .section-header {
        margin-bottom: 16px;
    }
    
    .section-header h3 {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
        margin: 0 0 4px 0;
    }
    
    .section-header p {
        font-size: 13px;
        color: #6b7280;
        margin: 0;
    }
    
    .time-travel-section {
        background: #f9fafb;
        border-radius: 6px;
        padding: 20px;
        border: 1px solid #e5e7eb;
    }
    
    .time-travel-form-row {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 12px;
        align-items: end;
    }
    
    .form-group-compact {
        display: flex;
        flex-direction: column;
    }
    
    .form-group-compact label {
        font-size: 12px;
        font-weight: 500;
        color: #374151;
        margin-bottom: 6px;
    }
    
    .form-group-compact input {
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 14px;
        background: #ffffff;
    }
    
    .btn-compact {
        padding: 8px 16px;
        font-size: 13px;
        border-radius: 4px;
        border: 1px solid #d1d5db;
        background: #ffffff;
        color: #111827;
        cursor: pointer;
        font-weight: 500;
    }
    
    .btn-compact-primary {
        background: #111827;
        color: #ffffff;
        border-color: #111827;
    }
    
    .btn-compact:hover {
        background: #f3f4f6;
    }
    
    .btn-compact-primary:hover {
        background: #374151;
    }
    
    .tabs-simple {
        display: flex;
        gap: 0;
        border-bottom: 2px solid #e5e7eb;
        margin-bottom: 24px;
    }
    
    .tab-simple {
        padding: 12px 24px;
        text-decoration: none;
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
        transition: all 0.2s;
    }
    
    .tab-simple:hover {
        color: #111827;
    }
    
    .tab-simple.active {
        color: #111827;
        border-bottom-color: #111827;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 32px;
    }
    
    .stat-box {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 20px;
    }
    
    .stat-label {
        font-size: 11px;
        font-weight: 500;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: #111827;
        margin-bottom: 4px;
    }
    
    .stat-note {
        font-size: 12px;
        color: #9ca3af;
    }
    
    .chart-section {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .chart-header {
        font-size: 15px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .time-travel-info {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
        font-size: 13px;
        color: #6b7280;
    }
</style>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<div class="reports-wrapper">
<!-- Time Travel Section -->
<div class="time-travel-section">
    <div class="section-header">
        <h3>Time Travel Report</h3>
        <p>View historical data for any date range</p>
    </div>
    <form method="get">
        <input type="hidden" name="report_type" value="{{ report_type }}">
        {% if client_type_filter %}<input type="hidden" name="client_type" value="{{ client_type_filter }}">{% endif %}
        {% if selected_client_id %}<input type="hidden" name="client" value="{{ selected_client_id }}">{% endif %}
        <div class="time-travel-form-row">
            <div class="form-group-compact">
                <label>Start Date</label>
                <input type="date" name="start_date" value="{{ start_date_str|default:'' }}">
            </div>
            <div class="form-group-compact">
                <label>End Date</label>
                <input type="date" name="end_date" value="{{ end_date_str|default:'' }}">
            </div>
            <div style="display: flex; gap: 8px;">
                <button type="submit" class="btn-compact btn-compact-primary">View Report</button>
                {% if time_travel_mode %}
                <a href="?report_type={{ report_type }}{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}" class="btn-compact">Clear</a>
                {% endif %}
            </div>
        </div>
    </form>
    {% if time_travel_mode %}
    <div class="time-travel-info">
        {% if start_date_str and end_date_str %}
            Showing data from <strong>{{ start_date_str }}</strong> to <strong>{{ end_date_str }}</strong>
        {% elif as_of_str %}
            Showing all data up to <strong>{{ as_of_str }}</strong>
        {% endif %}
    </div>
    {% endif %}
</div>

<!-- Client Type Filter Tabs -->
<div class="tabs-simple" style="margin-bottom: 16px;">
    <a href="?report_type={{ report_type }}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}" onclick="return changeClientType('', event)" class="tab-simple {% if not client_type_filter %}active{% endif %}">
        All Clients
    </a>
    <a href="?report_type={{ report_type }}&client_type=company{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}" onclick="return changeClientType('company', event)" class="tab-simple {% if client_type_filter == 'company' %}active{% endif %}">
        Company Clients
    </a>
    <a href="?report_type={{ report_type }}&client_type=my{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}" onclick="return changeClientType('my', event)" class="tab-simple {% if client_type_filter == 'my' %}active{% endif %}">
        My Clients
    </a>
</div>

<!-- Client Selector -->
<div style="margin-bottom: 20px; display: flex; align-items: center; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
    <label style="font-size: 14px; font-weight: 500; color: #374151;">Filter by Client:</label>
    <select id="clientFilter" onchange="changeClient(this.value)" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; background: #ffffff; min-width: 250px; cursor: pointer;">
        <option value="">All Clients</option>
        {% for client in all_clients %}
        <option value="{{ client.id }}" {% if selected_client_id == client.id %}selected{% endif %}>{{ client.name }}{% if client.code %} ({{ client.code }}){% endif %}</option>
        {% endfor %}
    </select>
    {% if selected_client_id %}
    <a href="?report_type={{ report_type }}{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}" class="btn-compact" style="text-decoration: none;">Clear Client Filter</a>
    {% endif %}
    {% if not all_clients %}
    <span style="font-size: 13px; color: #6b7280; font-style: italic;">No clients available</span>
    {% endif %}
</div>

<!-- Report Type Tabs -->
<div class="tabs-simple">
    <a href="?report_type=daily{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}" onclick="return changeReportType('daily', event)" class="tab-simple {% if report_type == 'daily' %}active{% endif %}">
        Daily
    </a>
    <a href="?report_type=weekly{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}" onclick="return changeReportType('weekly', event)" class="tab-simple {% if report_type == 'weekly' %}active{% endif %}">
        Weekly
    </a>
    <a href="?report_type=monthly{% if client_type_filter %}&client_type={{ client_type_filter }}{% endif %}{% if selected_client_id %}&client={{ selected_client_id }}{% endif %}{% if start_date_str %}&start_date={{ start_date_str }}{% endif %}{% if end_date_str %}&end_date={{ end_date_str }}{% endif %}" onclick="return changeReportType('monthly', event)" class="tab-simple {% if report_type == 'monthly' %}active{% endif %}">
        Monthly
    </a>
</div>

<!-- Summary Stats -->
<div class="stats-grid">
    <div class="stat-box">
        <div class="stat-label">Total Turnover</div>
        <div class="stat-value">₹ {{ total_turnover|default:0|floatformat:2 }}</div>
        <div class="stat-note">All-time transaction volume</div>
    </div>
    <div class="stat-box">
        <div class="stat-label">Your Total Profit</div>
        <div class="stat-value">₹ {{ your_total_profit|default:0|floatformat:2 }}</div>
        <div class="stat-note">Your share from profits</div>
    </div>
    {% if client_type_filter != 'my' %}
    <div class="stat-box">
        <div class="stat-label">Company Profit</div>
        <div class="stat-value">₹ {{ company_profit|default:0|floatformat:2 }}</div>
        <div class="stat-note">Company share from transactions</div>
    </div>
    {% endif %}
</div>

{% if report_type == 'daily' %}
<!-- Daily Report Section -->
<div class="chart-section">
    <div class="chart-header">Daily Trends (Last 30 Days)</div>
    <canvas id="dailyTrendsChart" style="max-height: 400px;"></canvas>
</div>

<div class="charts-grid">
    <div class="chart-section">
        <div class="chart-header">Transaction Type Breakdown</div>
        <canvas id="typeBreakdownChart" style="max-height: 320px;"></canvas>
    </div>
    
    {% if client_labels %}
    <div class="chart-section">
        <div class="chart-header">Top Clients by Profit (Last 30 Days)</div>
        <canvas id="topClientsChart" style="max-height: 320px;"></canvas>
    </div>
    {% endif %}
</div>

{% elif report_type == 'weekly' %}
<!-- Weekly Report Section -->
<div class="chart-section">
    <div class="chart-header">Weekly Trends (Last 4 Weeks)</div>
    <canvas id="weeklyTrendsChart" style="max-height: 400px;"></canvas>
</div>

<div class="charts-grid">
    <div class="chart-section">
        <div class="chart-header">Transaction Type Breakdown</div>
        <canvas id="typeBreakdownChart" style="max-height: 320px;"></canvas>
    </div>
    
    <div class="chart-section">
        <div class="chart-header">Daily Trends (Last 30 Days)</div>
        <canvas id="dailyTrendsChart" style="max-height: 320px;"></canvas>
    </div>
</div>

{% elif report_type == 'monthly' %}
<!-- Monthly Report Section -->
<div class="chart-section">
    <div class="chart-header">Monthly Trends (Last 6 Months)</div>
    <canvas id="monthlyTrendsChart" style="max-height: 400px;"></canvas>
</div>

<div class="charts-grid">
    <div class="chart-section">
        <div class="chart-header">Transaction Type Breakdown</div>
        <canvas id="typeBreakdownChart" style="max-height: 320px;"></canvas>
    </div>
    
    <div class="chart-section">
        <div class="chart-header">Weekly Trends (Last 4 Weeks)</div>
        <canvas id="weeklyTrendsChart" style="max-height: 320px;"></canvas>
    </div>
</div>
{% endif %}
</div>

<!-- Time Travel Transactions Table - Hidden during time travel -->

<script>
// Disable automatic scroll restoration
if ('scrollRestoration' in history) {
    history.scrollRestoration = 'manual';
}

// Preserve scroll position when changing report type
function changeReportType(type, event) {
    event.preventDefault();
    const currentScrollY = window.scrollY || window.pageYOffset;
    const url = new URL(window.location);
    
    // Preserve time travel parameters if they exist
    const startDate = url.searchParams.get('start_date');
    const endDate = url.searchParams.get('end_date');
    const dateParam = url.searchParams.get('date');
    const clientType = url.searchParams.get('client_type');
    const clientId = url.searchParams.get('client');
    
    // Build new URL
    url.searchParams.set('report_type', type);
    if (startDate) url.searchParams.set('start_date', startDate);
    if (endDate) url.searchParams.set('end_date', endDate);
    if (dateParam) url.searchParams.set('date', dateParam);
    if (clientType) url.searchParams.set('client_type', clientType);
    if (clientId) url.searchParams.set('client', clientId);
    
    // Store scroll position to restore after page load
    sessionStorage.setItem('reportScrollPosition', currentScrollY);
    window.location.href = url.toString();
    return false;
}

// Preserve scroll position when changing client type
function changeClientType(type, event) {
    event.preventDefault();
    const currentScrollY = window.scrollY || window.pageYOffset;
    const url = new URL(window.location);
    
    // Preserve time travel parameters if they exist
    const startDate = url.searchParams.get('start_date');
    const endDate = url.searchParams.get('end_date');
    const dateParam = url.searchParams.get('date');
    const reportType = url.searchParams.get('report_type') || 'monthly';
    const clientId = url.searchParams.get('client');
    
    // Build new URL
    url.searchParams.set('report_type', reportType);
    if (startDate) url.searchParams.set('start_date', startDate);
    if (endDate) url.searchParams.set('end_date', endDate);
    if (dateParam) url.searchParams.set('date', dateParam);
    if (clientId) url.searchParams.set('client', clientId);
    if (type) {
        url.searchParams.set('client_type', type);
    } else {
        url.searchParams.delete('client_type');
    }
    
    // Store scroll position to restore after page load
    sessionStorage.setItem('reportScrollPosition', currentScrollY);
    window.location.href = url.toString();
    return false;
}

// Preserve scroll position when changing client
function changeClient(clientId) {
    const currentScrollY = window.scrollY || window.pageYOffset;
    const url = new URL(window.location);
    
    // Preserve all parameters
    const startDate = url.searchParams.get('start_date');
    const endDate = url.searchParams.get('end_date');
    const dateParam = url.searchParams.get('date');
    const reportType = url.searchParams.get('report_type') || 'monthly';
    const clientType = url.searchParams.get('client_type');
    
    // Build new URL
    url.searchParams.set('report_type', reportType);
    if (startDate) url.searchParams.set('start_date', startDate);
    if (endDate) url.searchParams.set('end_date', endDate);
    if (dateParam) url.searchParams.set('date', dateParam);
    if (clientType) url.searchParams.set('client_type', clientType);
    if (clientId) {
        url.searchParams.set('client', clientId);
    } else {
        url.searchParams.delete('client');
    }
    
    // Store scroll position to restore after page load
    sessionStorage.setItem('reportScrollPosition', currentScrollY);
    window.location.href = url.toString();
}

// Restore scroll position immediately on page load
(function() {
    const savedScroll = sessionStorage.getItem('reportScrollPosition');
    if (savedScroll !== null) {
        const scrollPos = parseInt(savedScroll);
        // Restore immediately
        window.scrollTo(0, scrollPos);
        sessionStorage.removeItem('reportScrollPosition');
        
        // Also restore after DOM is ready and after a short delay
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                window.scrollTo(0, scrollPos);
            });
        }
        setTimeout(function() {
            window.scrollTo(0, scrollPos);
        }, 100);
    }
})();

// Initialize all charts after DOM and Chart.js are loaded
function initializeCharts() {
    // Check if Chart.js is loaded
    if (typeof Chart === 'undefined') {
        // Retry after a short delay if Chart.js isn't loaded yet
        setTimeout(initializeCharts, 100);
        return;
    }

    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeCharts);
        return;
    }

// Daily Trends Chart
{% if report_type == 'daily' or report_type == 'weekly' %}
const dailyChartEl = document.getElementById('dailyTrendsChart');
if (dailyChartEl) {
    const dailyCtx = dailyChartEl.getContext('2d');
    new Chart(dailyCtx, {
    type: 'line',
    data: {
        labels: {{ daily_labels }},
        datasets: [
            {
                label: 'Profit',
                data: {{ daily_profit }},
                borderColor: '#6b7280',
                backgroundColor: 'rgba(107, 114, 128, 0.1)',
                tension: 0.4,
                fill: true,
                borderWidth: 2
            },
            {
                label: 'Loss',
                data: {{ daily_loss }},
                borderColor: '#9ca3af',
                backgroundColor: 'rgba(156, 163, 175, 0.1)',
                tension: 0.4,
                fill: true,
                borderWidth: 2
            },
            {
                label: 'Turnover',
                data: {{ daily_turnover }},
                borderColor: '#4b5563',
                backgroundColor: 'rgba(75, 85, 99, 0.1)',
                tension: 0.4,
                fill: true,
                borderWidth: 2,
                yAxisID: 'y1'
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    padding: 15,
                    font: {
                        size: 13
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                titleFont: {
                    size: 14
                },
                bodyFont: {
                    size: 13
                },
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                },
                ticks: {
                    font: {
                        size: 12
                    },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                beginAtZero: true,
                grid: {
                    drawOnChartArea: false,
                },
                ticks: {
                    font: {
                        size: 12
                    },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                },
            },
            x: {
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                },
                ticks: {
                    font: {
                        size: 12
                    }
                }
            }
        }
    }
    });
}
{% endif %}

// Weekly Trends Chart
{% if report_type == 'weekly' or report_type == 'monthly' %}
const weeklyChartEl = document.getElementById('weeklyTrendsChart');
if (weeklyChartEl) {
    const weeklyCtx = weeklyChartEl.getContext('2d');
    new Chart(weeklyCtx, {
    type: 'bar',
    data: {
        labels: {{ weekly_labels }},
        datasets: [
            {
                label: 'Profit',
                data: {{ weekly_profit }},
                backgroundColor: 'rgba(107, 114, 128, 0.6)',
                borderColor: '#6b7280',
                borderWidth: 1,
                borderRadius: 4
            },
            {
                label: 'Loss',
                data: {{ weekly_loss }},
                backgroundColor: 'rgba(156, 163, 175, 0.6)',
                borderColor: '#9ca3af',
                borderWidth: 1,
                borderRadius: 4
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    padding: 15,
                    font: {
                        size: 13
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                titleFont: {
                    size: 14
                },
                bodyFont: {
                    size: 13
                },
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                },
                ticks: {
                    font: {
                        size: 12
                    },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                }
            },
            x: {
                grid: {
                    display: false
                },
                ticks: {
                    font: {
                        size: 12
                    }
                }
            }
        }
    }
    });
}
{% endif %}

// Transaction Type Breakdown Chart
{% if report_type == 'daily' or report_type == 'weekly' or report_type == 'monthly' %}
const typeChartEl = document.getElementById('typeBreakdownChart');
if (typeChartEl) {
    const typeCtx = typeChartEl.getContext('2d');
    new Chart(typeCtx, {
    type: 'doughnut',
    data: {
        labels: {{ type_labels }},
        datasets: [{
            data: {{ type_amounts }},
            backgroundColor: {{ type_colors }},
            borderWidth: 3,
            borderColor: '#ffffff'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 15,
                    font: {
                        size: 13
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                titleFont: {
                    size: 14
                },
                bodyFont: {
                    size: 13
                },
                callbacks: {
                    label: function(context) {
                        const label = context.label || '';
                        const value = context.parsed || 0;
                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                        const percentage = ((value / total) * 100).toFixed(1);
                        return label + ': ₹' + value.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' (' + percentage + '%)';
                    }
                }
            }
        }
    }
    });
}
{% endif %}

// Monthly Trends Chart
{% if report_type == 'monthly' %}
const monthlyChartEl = document.getElementById('monthlyTrendsChart');
if (monthlyChartEl) {
    const monthlyCtx = monthlyChartEl.getContext('2d');
    new Chart(monthlyCtx, {
    type: 'bar',
    data: {
        labels: {{ monthly_labels }},
        datasets: [
            {
                label: 'Profit',
                data: {{ monthly_profit }},
                backgroundColor: 'rgba(107, 114, 128, 0.6)',
                borderColor: '#6b7280',
                borderWidth: 1,
                borderRadius: 4
            },
            {
                label: 'Loss',
                data: {{ monthly_loss }},
                backgroundColor: 'rgba(156, 163, 175, 0.6)',
                borderColor: '#9ca3af',
                borderWidth: 1,
                borderRadius: 4
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    padding: 15,
                    font: {
                        size: 13
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                titleFont: {
                    size: 14
                },
                bodyFont: {
                    size: 13
                },
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                },
                ticks: {
                    font: {
                        size: 12
                    },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                }
            },
            x: {
                grid: {
                    display: false
                },
                ticks: {
                    font: {
                        size: 12
                    }
                }
            }
        }
    }
    });
}
{% endif %}

{% if report_type == 'daily' and client_labels %}
// Top Clients Chart
const clientsChartEl = document.getElementById('topClientsChart');
if (clientsChartEl) {
    const clientsCtx = clientsChartEl.getContext('2d');
    new Chart(clientsCtx, {
    type: 'bar',
    data: {
        labels: {{ client_labels }},
        datasets: [{
            label: 'Profit',
            data: {{ client_profits }},
            backgroundColor: 'rgba(107, 114, 128, 0.6)',
            borderColor: '#6b7280',
            borderWidth: 1,
            borderRadius: 4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        indexAxis: 'y',
        plugins: {
            legend: {
                display: false
            },
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                titleFont: {
                    size: 14
                },
                bodyFont: {
                    size: 13
                },
                callbacks: {
                    label: function(context) {
                        return '₹' + context.parsed.x.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                    }
                }
            }
        },
        scales: {
            x: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                },
                ticks: {
                    font: {
                        size: 12
                    },
                    callback: function(value) {
                        return '₹' + value.toLocaleString('en-IN');
                    }
                }
            },
            y: {
                grid: {
                    display: false
                },
                ticks: {
                    font: {
                        size: 12
                    }
                }
            }
        }
    }
    });
}
{% endif %}
}

// Start chart initialization
initializeCharts();
</script>
{% endblock %}
